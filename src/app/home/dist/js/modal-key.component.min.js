"use strict";var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(s=(n<3?r(s):3<n?r(t,o,s):r(t,o))||s);return 3<n&&s&&Object.defineProperty(t,o,s),s};exports.__esModule=!0,exports.ModalKeyComponent=void 0;var core_1=require("@angular/core"),forms_1=require("@angular/forms"),base_1=require("@cloudinary/base"),resize_1=require("@cloudinary/base/actions/resize"),environment_1=require("@environments/environment"),functions_1=require("@shared/functions"),bootstrap_1=require("bootstrap"),ModalKeyComponent=function(){function e(e,t,o){this.element=e,this.keys=t,this.exchanges=o,this.key={_id:"",code:"",desc:"",image:new Array,createdAt:new Date,updatedAt:new Date},this.keyUpdate=new forms_1.FormGroup({line:new forms_1.FormControl("",[forms_1.Validators.required,forms_1.Validators.minLength(6),forms_1.Validators.maxLength(6)]),code:new forms_1.FormControl("",[forms_1.Validators.required,forms_1.Validators.minLength(4),forms_1.Validators.maxLength(4)]),desc:new forms_1.FormControl("",[forms_1.Validators.required])}),this.resetImage=new forms_1.FormControl("",[forms_1.Validators.required]),this.isLoading=!1,this.cloudinary=environment_1.environment.cloudinary}return e.prototype.ngAfterViewInit=function(){this.modal=new bootstrap_1.Modal(this.element.nativeElement)},e.prototype.ngOnDestroy=function(){this.hide()},Object.defineProperty(e.prototype,"images",{get:function(){return this.key.image.sort(function(e,t){return e.idN-t.idN}).filter(function(e){return e.url})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineValidator",{get:function(){var e,t;return null!==(t=null===(e=this.keyUpdate.get("line"))||void 0===e?void 0:e.invalid)&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"codeValidator",{get:function(){var e,t;return null!==(t=null===(e=this.keyUpdate.get("code"))||void 0===e?void 0:e.invalid)&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descValidator",{get:function(){var e,t;return null!==(t=null===(e=this.keyUpdate.get("desc"))||void 0===e?void 0:e.invalid)&&void 0!==t&&t},enumerable:!1,configurable:!0}),e.prototype.setKey=function(){var e,t,o;null!==(e=this.keyUpdate.get("line"))&&void 0!==e&&e.setValue(this.key.code.slice(0,6)),null!==(t=this.keyUpdate.get("code"))&&void 0!==t&&t.setValue(this.key.code.slice(6,10)),null!==(o=this.keyUpdate.get("desc"))&&void 0!==o&&o.setValue(this.key.desc)},e.prototype.show=function(){var e;null!==(e=this.modal)&&void 0!==e&&e.show(),this.setKey()},e.prototype.hide=function(){var e;null!==(e=this.modal)&&void 0!==e&&e.hide()},e.prototype.transform=function(e){return new base_1.CloudinaryImage(e.public_id,{cloudName:this.cloudinary}).resize(resize_1.Resize.scale().width(119)).toURL()},e.prototype.statusClass=function(){return this.resetImage.value?"idN"+this.resetImage.value:""},e.prototype.onSubmit=function(){var o=this;this.keyUpdate.valid&&!this.isLoading&&(this.isLoading=!0,this.exchanges.updateKey(this.key._id,this.keyUpdate.getRawValue()).subscribe({next:function(e){var t=e.data;o.keys.update=t,o.hide(),o.isLoading=!1,functions_1.Alert.fire({title:"Clave Actualizada",text:o.key.code,icon:"success"})},error:function(){o.isLoading=!1,functions_1.Alert.fire({title:"Error Actualización",text:o.key.code,icon:"error"})}}))},e.prototype.onReset=function(){var t,e,o=this;this.isLoading||(this.isLoading=!0,e=(t=this.resetImage.value)?{status:+t}:{},this.exchanges.resetKey(this.key._id,e).subscribe({next:function(e){e.data;o.keys.resetImage(o.key._id,t),o.hide(),o.isLoading=!1,functions_1.Alert.fire({title:"Imagenes Reseteadas",text:o.key.code,icon:"success"})},error:function(){o.isLoading=!1,functions_1.Alert.fire({title:"Error Actualización",text:o.key.code,icon:"error"})}}))},e=__decorate([core_1.Component({selector:"modal-key",templateUrl:"./modal-key.component.html",styleUrls:["./modal-key.component.scss"],host:{class:"modal fade animate__animated animate__backInDown",tabindex:"-1"}})],e)}();exports.ModalKeyComponent=ModalKeyComponent;